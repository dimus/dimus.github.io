---
layout: post
tags: docker chef eol rhel
date: 2015-04-26 10:18:40
title: Docker on RedHat 6.6 -- switching users problem
published: true
---

After recent upgrade of RHEL 6.6 we found that some of our Docker containers
stopped working.  We found that containers lost ability to run commands as any
user but root so commands like

    su www-data -c 'some_command'

generated an error:

    su: User not known to the underlying authentication module

Trying to run

    su - a_user

would generate

    Unable to cd to '/home/a_user'

running

    su a_user

generated

    Cannot execute /bin/bash: Permission denied
    su: User not known to the underlying authentication module

The same was true about containers we built remotely or locally. The same
containers would work fine on Ubuntu and even updated Centos 6.6. After several
hours I tried to run

    strace su www-data > strace_dump

inside of container and found that not only /bin/bash is not accessable, but
any directory is closed for any user but root. After this revelation it was
easy to find out that the **underlying problem was `drwx----` permission on /
directory**.

What causes this problem? We still don&rsquo;t know, but we can continue with our
lives now. See [bug report][1] about this issue.

[1]: https://github.com/docker/docker/issues/12745

